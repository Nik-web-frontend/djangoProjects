{% extends 'layouts/app.html' %}

{% load static %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock%}

{% block content %}

<h2 class="profile-heading">Profile Page</h2>
<div class="profile-container">
    <div class="profile-details">
        <div class="details">
            {% if profile.profile_pic %}
            <img class="profile-pic" src="{{ profile.profile_pic.url }}" alt="Profile Picture">
            {% else %}
            <p
                style="border-radius: 50%; background-color: teal; height: 100px; width: 100px; text-align: center;display: flex;align-items: center;justify-content: center;">
                ‚ùï</p>
            {% endif %}
            <div class="name-prof">
                {% if profile.name %}
                <p>Name: {{ profile.name }}</p>
                {% else %}
                <p>{{request.user.username}}</p>
                {% endif %}
                <p>Profession: {{ profile.profession }}</p>
            </div>
        </div>


        <br><br>
        <button id="manageProfileBtn">Manage Profile</button>
    </div>
</div>



<div id="profileModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
     background: rgba(0,0,0,0.5); justify-content:center; align-items:center;">
    <div style="background:white; padding:20px; border-radius:8px; width:300px;">
        <span id="closeModal" style="float:right; cursor:pointer;">&times;</span>
        <h3>Edit Profile</h3>

        <!-- Edit Form -->
        <form method="POST" action="{% url 'profile' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <label>Name:</label>
            <input type="text" name="name" value="{{ profile.name }}" />

            <label>Profession:</label>
            <input type="text" name="profession" value="{{ profile.profession }}" />

            <label>Profile Picture:</label>
            <input type="file" name="profile_pic" />

            <button type="submit">Save Changes</button>
        </form>

        <button id="del-profile">Delete Profile</button>
        <!-- Delete Profile Form -->

    </div>
</div>

<div class="del-popup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
     background: rgba(0,0,0,0.5); justify-content:center; align-items:center;">
    <div style="background:white; padding:20px; border-radius:8px; width:300px;">
        <form method="POST" action="{% url 'delete_profile' %}" style="margin-top:10px;">
            {% csrf_token %}
            <button type="submit" style="background:red; color:white;">Delete Profile</button>
        </form>
        <button class="profile-cancel">Cancel</button>
    </div>
</div>

<script>
    const modal = document.getElementById('profileModal');
    const btn = document.getElementById('manageProfileBtn');
    const close = document.getElementById('closeModal');

    btn.onclick = function () {
        modal.style.display = 'flex'; // show popup
    }

    close.onclick = function () {
        modal.style.display = 'none'; // hide popup
    }

    // Close popup if user clicks outside modal
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }

    const delProfile = document.querySelector('#del-profile');
    const delPopup = document.querySelector('.del-popup');
    const cancelBtn = document.querySelector('.profile-cancel');

    delProfile.onclick = function () {
        delPopup.style.display = 'flex'; // show popup
    }

    cancelBtn.onclick = function () {
        delPopup.style.display = 'none'; // hide popup
    }

</script>


{% endblock %}